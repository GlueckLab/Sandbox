<?xml version="1.0" encoding="UTF-8"?>
<project name="powercalculatorgui" default="deploy" basedir=".">
	
    <property name="source.dir" value="${basedir}/../src" />
	<property name="jar.dir" value="${basedir}/../jar" />
	<property name="javabuild.dir" value="${wardir}/build" />
	<property name="target.dir"  value="${wardir}/powercalculatorgui"/>
	<property name="javadoc.dir" value="${basedir}/../javadoc" />
	<property name="thirdparty.dir" value="${basedir}/../../thirdparty" />
	
  	<path id="classpath">
    	<pathelement location="${javabuild.dir}"/>
    	<pathelement location="${source.dir}"/>
    	<pathelement location="${gwt.dir}/gwt-user.jar"/>
    	<!-- next line is platform-specific -->
    	<pathelement location="${gwt.dir}/gwt-dev-mac.jar"/>
    	<pathelement location="${gwt.dir}/gwt-servlet.jar"/>
    	<pathelement location="${junit.jar}"/>
    	<pathelement location="${servlet-api.jar}"/>
  	</path>
  
	<target name="clean" description="deletes all generated files">
    	<delete dir="${target.dir}"/> 
  		<delete dir="${javabuild.dir}"/>
	</target>

	<target name="compile" depends="prepare"
    	description="compiles Java source files to bytecode">
		<javac srcdir="src" destdir="${javabuild.dir}" classpathref="classpath" debug="true">
    	</javac>
  	</target>

  	<target name="compile.gwt" depends="compile"
    	description="compiles Java source files to JavaScript">
    	<!-- Consider adding -Xms256m -Xmx512m to improve performance. -->
    	<java classname="com.google.gwt.dev.GWTCompiler"	classpathref="classpath" fork="true">
      		<arg line="-out ${target.dir}"/>
      		<arg line="-style OBFUSCATE"/>
      		<arg value="${package}.${module}"/>
    	</java>
  	</target>

 	 <target name="deploy" depends="jar,undeploy"
    	description="deploys the jar file to Apache httpd (assumes client code only)">
    	<copy file="build/${war}" todir="${tomcat.dir}/webapps"/>
    	<echo>browse ${url}</echo>
  	</target>

  	<target name="hosted" depends="compile"
    	description="runs the application in hosted mode">
    	<java classname="com.google.gwt.dev.GWTShell"
     		classpathref="classpath" fork="true">
      		<arg line="-out ./www"/>
      		<arg line="${package}.${module}/${module}.html"/>
    	</java>
  	</target>

  <target name="prepare" description="creates output directories">
    <mkdir dir="${javabuild.dir}"/>
    <mkdir dir="${target.dir}"/>
  </target>


  <target name="undeploy" description="undeploys the client code from httpd server" >
    <delete dir="${httpd.docs.dir}/${ant.project.name}"/>
    <delete file="${tomcat.dir}/webapps/${war}"/>
  </target>
  
  <target name="jar" depends="compile, compile.gwt"
    description="builds the jar file">
    <delete file="build/${war}"/>
    <war warfile="build/${war}" webxml="web.xml">
      <!-- bytecode from your Java code -->
      <classes dir="build" includes="**/*.class"/>
      <!-- generated HTML/JavaScript plus your CSS -->
      <fileset dir="build/www"/>
      <!-- supplied JAR -->
      <lib file="${gwt.dir}/gwt-servlet.jar"/>
    </war>
  </target>

</project>